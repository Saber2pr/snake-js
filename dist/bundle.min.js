var test=function(){"use strict";var u="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function t(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function e(t,e){return t(e={exports:{}},e.exports),e.exports}var o=e(function(t,e){function n(t,e){var n=Date.now(),o={value:e?e.delta:17},r={value:!!e&&e.cancel},i={value:e?e.delayCancel:-1},a=e?e.frames:-1,c=0,u=function(){if(Date.now()-n>o.value){if(r.value)return;if(0<a&&a<=c)return;n=Date.now(),t(o.value),c++}requestAnimationFrame(u)};return requestAnimationFrame(u),0<i.value&&setTimeout(function(){return r.value=!0},i.value),function(){return r.value=!0}}Object.defineProperty(e,"__esModule",{value:!0}),e.call=function(t,e){void 0===e&&(e=1);var n,o=0,r=function(){return e<=o||(n=t(++o),r()),n};return r()},e.schedule=n,e.scheduleOnce=function(t,e){return n(t,{delta:e,frames:1})}});t(o);o.call,o.schedule,o.scheduleOnce;var a=e(function(t,n){Object.defineProperty(n,"__esModule",{value:!0}),function(t){for(var e in t)n.hasOwnProperty(e)||(n[e]=t[e])}(o)});t(a);var r=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function o(t){this.instance=t}return Object.defineProperty(o.prototype,"foot",{get:function(){for(var t=this;t.next;)t=t.next;return t},enumerable:!0,configurable:!0}),o.prototype.set=function(e){var n=this;return function(t){return n[e]=t,n}},o.link=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t.reduceRight(function(t,e){return new o(e).set("next")(t)},null)},o.prototype.toArray=function(){var e=[];return this.forEach(function(t){return e.push(t)}),e},o.prototype.forEach=function(t,e){for(var n=this,o=0;n;)t.call(e,n.instance,o,this),n=n.next,o++},o.prototype.reverse=function(){var t=new o(null);t.next=this;for(var e=t.next,n=e.next;n;)e.next=n.next,n.next=t.next,t.next=n,n=e.next;return t.next},o}();e.List=n});t(r);r.List;var i=e(function(t,o){Object.defineProperty(o,"__esModule",{value:!0});var r=function(t){var n=this;this.instance=t,this.set=function(e){return function(t){return n[e]=t,n}}};o.Fiber=r,o.link=function(n){return n.instance.children&&n.set("child")(n.instance.children.reduceRight(function(t,e){return new r(e).set("parent")(n).set("sibling")(t)},null)).child},o.walk=function(t){t.child||o.link(t);var e=t;if(e.child)return e.child;if(e.sibling)return e.sibling;if(!e.parent)return e;for(;!e.parent.sibling;)if(!(e=e.parent).parent)return null;return e.parent.sibling},o.walkAll=function(t,e){for(var n=new r(t);n;)e(n.instance),n=o.walk(n)}});t(i);i.Fiber,i.link,i.walk,i.walkAll;var c=e(function(t,n){function e(t){for(var e in t)n.hasOwnProperty(e)||(n[e]=t[e])}Object.defineProperty(n,"__esModule",{value:!0}),e(r),e(i)});t(c);var s=e(function(t,e){var a,n;Object.defineProperty(e,"__esModule",{value:!0}),(n=a=e.Rules||(e.Rules={})).isLabel=function(t){return"Label"===t.type},n.isLabelPropsArray=function(t){return n.isLabel(t[0])},n.isNode=function(t){return"Node"===t.type},n.isNodePropsArray=function(t){return n.isNode(t[0])},n.isSprite=function(t){return"Sprite"===t.type},n.isSpritePropsArray=function(t){return n.isSprite(t[0])},n.isCanvas=function(t){return void 0!==t.getContext},n.isCtx=function(t){return void 0!==t.canvas};var o=function(){function t(t,e,n){var i=this,o=function(t,e,n){var o=document.getElementById(t);if(!o)throw"cannot get canvas element by id: "+t;if(a.isCanvas(o)){o.width=e,o.height=n;var r=o.getContext("2d");a.isCtx(r)&&(i.ctx=r)}};"object"==typeof t?o(t.elementId,t.MaxWidth,t.MaxHeight):o(t,e,n)}return t.prototype.clear=function(t){if(t){var e=t.x,n=t.y,o=t.width,r=t.height;return this.ctx.clearRect(e,n,o,r),this}return this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this},t.prototype.fillNode=function(t){var e=t.x,n=t.y,o=t.width,r=t.height,i=t.color;this.ctx.fillStyle=i,this.ctx.fillRect(e,n,o,r)},t.prototype.fillLabel=function(t){var e=t.x,n=t.y,o=t.height,r=t.color,i=t.fontSize,a=t.fontStyle,c=t.text;this.ctx.font=String(i)+"px "+a,this.ctx.strokeStyle=r,this.ctx.strokeText(c,e,n+o)},t.prototype.fillImage=function(t){var e=this,n=t.x,o=t.y,r=t.width,i=t.height,a=t.img;a.onloadend=function(){return e.ctx.drawImage(a,n,o,r,i)}},t.prototype.getImageData=function(t,e,n,o){return this.ctx.getImageData(t,e,n,o)},t.prototype.draw=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return 0<t.length&&(a.isLabelPropsArray(t)?t.forEach(function(t){return e.fillLabel(t)}):a.isNodePropsArray(t)?t.forEach(function(t){return e.fillNode(t)}):a.isSpritePropsArray(t)&&t.forEach(function(t){return e.fillImage(t)})),this},t}();e.Canvas=o});t(s);s.Rules,s.Canvas;var f=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){this.x=t,this.y=e}return t.prototype.equals=function(t){return this.x===t.x&&this.y===t.y},t}();e.Vec2=n,e.v2=function(t,e){return"object"==typeof t?new n(t.x,t.y):new n(t,e||t)}});t(f);f.Vec2,f.v2;var l=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(t,e){this.width=t,this.height=e};e.Size=n});t(l);l.Size;var h=e(function(t,e){var o,r=u&&u.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){this.x=0,this.y=0,this.width=t,this.height=e,this.type="Rect"}return t.prototype.setPosition=function(t,e){return"number"==typeof t?(this.x=t,this.y=e||t):(this.x=t.x,this.y=t.y),this},t.prototype.getPosition=function(){return f.v2(this.x,this.y)},t.prototype.setSize=function(t,e){return this.width=t,this.height=e,this},t.prototype.getContentSize=function(){return new l.Size(this.width,this.height)},t}(),i=function(o){function t(t,e){var n=o.call(this,t,e)||this;return n.color="#3a32af",n.type="Node",n}return r(t,o),t.prototype.setColor=function(t){return this.color=t,this},t}(e.Rect=n),a=function(o){function t(t,e){void 0===e&&(e=23);var n=o.call(this,t.length*e,e)||this;return n.fontStyle="serif",n.color="563a6d",n.text=t,n.fontSize=e,n.type="Label",n}return r(t,o),t.prototype.setFontSize=function(t){return this.fontSize=t,this.setSize(this.text.length*t,t),this},t.prototype.setFontStyle=function(t){return this.fontStyle=t,this},t.prototype.setText=function(t){return this.text=t,this},t}(e.Node=i);e.Label=a;var c=function(n){function t(t){var e=n.call(this,0,0)||this;return e.type="Sprite",e.img=new Image,e.img.src=t,e.setSize(e.img.width,e.img.height),e}return r(t,n),t.prototype.setSrc=function(t){return this.img.src=t,this},t}(n);e.Sprite=c});t(h);h.Rect,h.Node,h.Label,h.Sprite;var d=e(function(t,n){function e(t){for(var e in t)n.hasOwnProperty(e)||(n[e]=t[e])}Object.defineProperty(n,"__esModule",{value:!0}),e(s),e(h),e(l),e(f)});t(d);var p=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.createBlock=function(t,e){return void 0===e&&(e=t),new n(new d.Node(t,e))};var n=function(){function t(t){this.node=t,this.children=[]}return t.prototype.append=function(t){this.children.push(t)},t}();e.Block=n});t(p);p.createBlock,p.Block;var v=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.config={elementId:"root",MaxWidth:500,MaxHeight:500,bodySize:50,colors:{food:"yellow",body:"green",background:"blue",head:"red"},fps:500}});t(v);v.config;var y=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.Background=p.createBlock(v.config.MaxWidth,v.config.MaxHeight),e.Background.node.setColor(v.config.colors.background)});t(y);y.Background;var g=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){var n=this;this.instance=t,this.pre=null,this.set=function(e){return function(t){return n[e]=t,n}}};e.ListNode=n});t(g);g.ListNode;var b=e(function(t,e){var n=u&&u.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e};Object.defineProperty(e,"__esModule",{value:!0});var o=n(d),r=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.foot=t.reduce(function(t,e){return new g.ListNode(e).set("pre")(t)},null),this.step=this.foot.instance.getContentSize().width}return Object.defineProperty(t.prototype,"head",{get:function(){for(var t=this.foot;t.pre;)t=t.pre;return t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){for(var t=1,e=this.foot;e.pre;)e=e.pre,t++;return t},enumerable:!0,configurable:!0}),t.prototype.move=function(t){for(var e=this.foot;e.pre;){var n=e.pre.instance.getPosition();e.instance.setPosition(n),e=e.pre}return e.instance.setPosition(this.getNextPos(t)),this},t.prototype.eat=function(t){this.head.pre=new g.ListNode(t)},t.prototype.getNextPos=function(t){var e=this.head.instance.getPosition();switch(t){case"down":return o.v2(e.x,e.y-this.step);case"left":return o.v2(e.x-this.step,e.y);case"right":return o.v2(e.x+this.step,e.y);case"up":return o.v2(e.x,e.y+this.step)}},t.prototype.meet=function(t){return this.head.instance.getPosition().equals(t)},t}();e.Snake=r});t(b);b.Snake;var x=e(function(t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.random=function(t,e){return void 0===e&&(e=0),e+(t-e)*Math.random()},n.rand=function(t,e){return void 0===e&&(e=0),parseInt(String(n.random(t,e)))},n.randVec=function(t,e){return void 0===e&&(e=t),{x:n.rand(t),y:n.rand(e)}},n.uuid=function(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}});t(x);x.random,x.rand,x.randVec,x.uuid;var w=e(function(t,n){Object.defineProperty(n,"__esModule",{value:!0}),function(t){for(var e in t)n.hasOwnProperty(e)||(n[e]=t[e])}(x)});t(w);var k=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.getRandPos=function(t){var e=t.bodySize,n=t.MaxWidth,o=t.MaxHeight,r=w.rand(n/e),i=w.rand(o/e);return d.v2(e*r,e*i)},e.getRandColor=function(){var t=w.rand(0,10);return 8<t?"red":6<t?"green":4<t?"black":2<t?"":"yellow"}});t(k);k.getRandPos,k.getRandColor;var _=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.canvas=new d.Canvas(v.config),e.createFood=function(){var t=p.createBlock(v.config.bodySize);return t.node.setPosition(k.getRandPos(v.config)).setColor(k.getRandColor()),t};var n=p.createBlock(v.config.bodySize);n.node.setColor(v.config.colors.body).setPosition(150,50).setColor(v.config.colors.head),y.Background.append(n);var o=p.createBlock(v.config.bodySize);o.node.setColor(v.config.colors.body).setPosition(100,50),y.Background.append(o),e.snake=new b.Snake(n.node,o.node)});t(_);_.canvas,_.createFood,_.snake;var P=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e,n,o){this.callbackLeft=t,this.callbackRight=e,this.callbackUp=n,this.callbackDown=o,this.offset=100,this.delta=200}return t.prototype.onLeft=function(t){return this.callbackLeft=t,this},t.prototype.onRight=function(t){return this.callbackRight=t,this},t.prototype.onUp=function(t){return this.callbackUp=t,this},t.prototype.onDown=function(t){return this.callbackDown=t,this},t.prototype.setProps=function(t,e){return void 0===t&&(t=100),void 0===e&&(e=200),this.offset=t,this.delta=e,this},t.prototype.onStart=function(t){return this.callbackStart=t,this},t.prototype.onUpdate=function(t){return this.callbackUpdate=t,this},t.prototype.onStop=function(t){return this.callbackStop=t,this},t.prototype.listen=function(t){var e,n=this;void 0===t&&(t=document.body);var o,r=0;t.addEventListener("mouseenter",function(){o="enter"}),t.addEventListener("mousedown",function(t){e=t,(o="enter")===o&&n.callbackStart&&n.callbackStart(t)}),t.addEventListener("mousemove",function(t){r++,"enter"===o&&Boolean(e)&&n.callbackUpdate&&n.callbackUpdate(t)}),t.addEventListener("mouseup",function(t){r<n.delta&&n.testPos(e,t,t),r=0,"enter"===o&&n.callbackStop&&n.callbackStop(t),e=o=null}),t.addEventListener("mouseout",function(){o=null})},t.prototype.testPos=function(t,e,n){Math.abs(e.x-t.x)<this.offset&&Math.abs(e.y-t.y)<this.offset||(Math.abs(e.x-t.x)>Math.abs(e.y-t.y)?e.x-t.x>this.offset?this.callbackRight&&this.callbackRight(n):e.x-t.x<-this.offset&&this.callbackLeft&&this.callbackLeft(n):e.y-t.y>this.offset?this.callbackDown&&this.callbackDown(n):e.y-t.y<-this.offset&&this.callbackUp&&this.callbackUp(n))},t}();e.TouchFront=n});t(P);P.TouchFront;var S=e(function(t,n){Object.defineProperty(n,"__esModule",{value:!0}),function(t){for(var e in t)n.hasOwnProperty(e)||(n[e]=t[e])}(P)});return t(S),t(e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});function n(t){var e;_.canvas.clear(),e=t,c.walkAll(e,function(t){_.canvas.draw(t.node)})}var o=_.createFood();y.Background.append(o);var r="right",i=function(){_.snake.move(r).meet(o.node.getPosition())&&(_.snake.eat(o.node),o=_.createFood(),y.Background.append(o)),n(y.Background)};i(),a.schedule(i,{delta:v.config.fps}),(new S.TouchFront).onLeft(function(){return r="left"}).onRight(function(){return r="right"}).onUp(function(){return r="down"}).onDown(function(){return r="up"}).listen(),alert("手势控制方向！准备好了么？")}))}();