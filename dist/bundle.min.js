var test=function(){"use strict";var s="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function t(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function e(t,e){return t(e={exports:{}},e.exports),e.exports}var r=e(function(t,e){function n(t,e){var n=Date.now(),r={value:e?e.delta:17},o={value:!!e&&e.cancel},i={value:e?e.delayCancel:-1},u=e?e.frames:-1,a=0,s=function(){if(Date.now()-n>r.value){if(o.value)return;if(0<u&&u<=a)return;n=Date.now(),t(r.value),a++}requestAnimationFrame(s)};return requestAnimationFrame(s),0<i.value&&setTimeout(function(){return o.value=!0},i.value),function(){return o.value=!0}}Object.defineProperty(e,"__esModule",{value:!0}),e.call=function(t,e){void 0===e&&(e=1);var n,r=0,o=function(){return e<=r||(n=t(++r),o()),n};return o()},e.schedule=n,e.scheduleOnce=function(t,e){return n(t,{delta:e,frames:1})}});t(r);r.call,r.schedule,r.scheduleOnce;var i=e(function(t,n){Object.defineProperty(n,"__esModule",{value:!0}),function(t){for(var e in t)n.hasOwnProperty(e)||(n[e]=t[e])}(r)});t(i);var o=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function r(t){this.instance=t}return Object.defineProperty(r.prototype,"foot",{get:function(){for(var t=this;t.next;)t=t.next;return t},enumerable:!0,configurable:!0}),r.prototype.set=function(e){var n=this;return function(t){return n[e]=t,n}},r.link=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t.reduceRight(function(t,e){return new r(e).set("next")(t)},null)},r.prototype.toArray=function(){var e=[];return this.forEach(function(t){return e.push(t)}),e},r.prototype.forEach=function(t,e){for(var n=this,r=0;n;)t.call(e,n.instance,r,this),n=n.next,r++},r.prototype.reverse=function(){var t=new r(null);t.next=this;for(var e=t.next,n=e.next;n;)e.next=n.next,n.next=t.next,t.next=n,n=e.next;return t.next},r}();e.List=n});t(o);o.List;var u=e(function(t,r){Object.defineProperty(r,"__esModule",{value:!0});var o=function(t){var n=this;this.instance=t,this.set=function(e){return function(t){return n[e]=t,n}}};r.Fiber=o,r.link=function(n){return n.instance.children&&n.set("child")(n.instance.children.reduceRight(function(t,e){return new o(e).set("parent")(n).set("sibling")(t)},null)).child},r.walk=function(t){t.child||r.link(t);var e=t;if(e.child)return e.child;if(e.sibling)return e.sibling;if(!e.parent)return e;for(;!e.parent.sibling;)if(!(e=e.parent).parent)return null;return e.parent.sibling},r.walkAll=function(t,e){for(var n=new o(t);n;)e(n.instance),n=r.walk(n)}});t(u);u.Fiber,u.link,u.walk,u.walkAll;var a=e(function(t,n){function e(t){for(var e in t)n.hasOwnProperty(e)||(n[e]=t[e])}Object.defineProperty(n,"__esModule",{value:!0}),e(o),e(u)});t(a);var c=e(function(t,e){var u,n;Object.defineProperty(e,"__esModule",{value:!0}),(n=u=e.Rules||(e.Rules={})).isLabel=function(t){return"Label"===t.type},n.isLabelPropsArray=function(t){return n.isLabel(t[0])},n.isNode=function(t){return"Node"===t.type},n.isNodePropsArray=function(t){return n.isNode(t[0])},n.isSprite=function(t){return"Sprite"===t.type},n.isSpritePropsArray=function(t){return n.isSprite(t[0])},n.isCanvas=function(t){return void 0!==t.getContext},n.isCtx=function(t){return void 0!==t.canvas};var r=function(){function t(t,e,n){var i=this,r=function(t,e,n){var r=document.getElementById(t);if(!r)throw"cannot get canvas element by id: "+t;if(u.isCanvas(r)){r.width=e,r.height=n;var o=r.getContext("2d");u.isCtx(o)&&(i.ctx=o)}};"object"==typeof t?r(t.elementId,t.MaxWidth,t.MaxHeight):r(t,e,n)}return t.prototype.clear=function(t){if(t){var e=t.x,n=t.y,r=t.width,o=t.height;return this.ctx.clearRect(e,n,r,o),this}return this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this},t.prototype.fillNode=function(t){var e=t.x,n=t.y,r=t.width,o=t.height,i=t.color;this.ctx.fillStyle=i,this.ctx.fillRect(e,n,r,o)},t.prototype.fillLabel=function(t){var e=t.x,n=t.y,r=t.height,o=t.color,i=t.fontSize,u=t.fontStyle,a=t.text;this.ctx.font=String(i)+"px "+u,this.ctx.strokeStyle=o,this.ctx.strokeText(a,e,n+r)},t.prototype.fillImage=function(t){var e=this,n=t.x,r=t.y,o=t.width,i=t.height,u=t.img;u.onloadend=function(){return e.ctx.drawImage(u,n,r,o,i)}},t.prototype.getImageData=function(t,e,n,r){return this.ctx.getImageData(t,e,n,r)},t.prototype.draw=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return 0<t.length&&(u.isLabelPropsArray(t)?t.forEach(function(t){return e.fillLabel(t)}):u.isNodePropsArray(t)?t.forEach(function(t){return e.fillNode(t)}):u.isSpritePropsArray(t)&&t.forEach(function(t){return e.fillImage(t)})),this},t}();e.Canvas=r});t(c);c.Rules,c.Canvas;var f=e(function(t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.negative=function(t){return 0===t?0:-1*t},r.square=function(t){return Math.pow(t,2)},r.magnitude2d=function(t,e){return Math.sqrt(r.square(t)+r.square(e))},r.magnitude3d=function(t,e,n){return Math.sqrt(r.square(t)+r.square(e)+r.square(n))},r.angleToRad=function(t){return t*Math.PI/180},r.radToAngle=function(t){return 180*t/Math.PI};var n=function(){function e(t,e){var n=this;this.x=t,this.y=e,this.props=function(){return{x:n.x,y:n.y}}}return e.prototype.equals=function(t){return t.x===this.x&&t.y===this.y},e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y)},e.prototype.sub=function(t){return new e(this.x-t.x,this.y-t.y)},e.prototype.mul=function(t){return new e(this.x*t.x,this.y*t.y)},e.prototype.scale=function(t){return this.mul(new e(t,t))},e.prototype.div=function(t){return new e(this.x/t.x,this.y/t.y)},e.prototype.neg=function(){return new e(r.negative(this.x),r.negative(this.y))},e.prototype.mag=function(){return r.magnitude2d(this.x,this.y)},e.prototype.angleWith=function(t){return Math.acos(this.dot(t)/(this.mag()*t.mag()))},e.prototype.dot=function(t){return this.x*t.x+this.y*t.y},e.prototype.cross=function(t){return new o(0,0,this.x*t.y-this.y*t.x)},e.prototype.unitized=function(){return new e(this.x/this.mag(),this.y/this.mag())},e}();r.Vec2=n,r.v2=function(t,e){return"object"==typeof t?new n(t.x,t.y):new n(t,e||t)};var o=function(){function e(t,e,n){var r=this;this.x=t,this.y=e,this.z=n,this.props=function(){return{x:r.x,y:r.y,z:r.z}}}return e.prototype.equals=function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z},e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y,this.z+t.z)},e.prototype.sub=function(t){return new e(this.x-t.x,this.y-t.y,this.z-t.z)},e.prototype.mul=function(t){return new e(this.x*t.x,this.y*t.y,this.z*t.z)},e.prototype.scale=function(t){return this.mul(new e(t,t,t))},e.prototype.div=function(t){return new e(this.x/t.x,this.y/t.y,this.z/t.z)},e.prototype.neg=function(){return new e(r.negative(this.x),r.negative(this.y),r.negative(this.z))},e.prototype.mag=function(){return r.magnitude3d(this.x,this.y,this.z)},e.prototype.angleWith=function(t){return Math.acos(this.dot(t)/(this.mag()*t.mag()))},e.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},e.prototype.cross=function(t){return new e(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)},e.prototype.unitized=function(){return new e(this.x/this.mag(),this.y/this.mag(),this.z/this.mag())},e}();r.Vec3=o;var e=function(){function o(t,e){this.start=t,this.end=e}return o.prototype.projection=function(t){var e=this.toVec().angleWith(t.toVec()),n=this.toVec().mag()*Math.cos(e),r=t.toVec().unitized();return new o(t.start,r.scale(n))},o.prototype.toVec=function(){return this.end.sub(this.start)},o}();r.Line2D=e;var i=function(){function o(t,e){this.start=t,this.end=e}return o.prototype.projection=function(t){var e=this.toVec().angleWith(t.toVec()),n=this.toVec().mag()*Math.cos(e),r=t.toVec().unitized();return new o(t.start,r.scale(n))},o.prototype.toVec=function(){return this.end.sub(this.start)},o}();r.Line3D=i});t(f);f.negative,f.square,f.magnitude2d,f.magnitude3d,f.angleToRad,f.radToAngle,f.Vec2,f.v2,f.Vec3,f.Line2D,f.Line3D;var h=e(function(t,n){Object.defineProperty(n,"__esModule",{value:!0}),function(t){for(var e in t)n.hasOwnProperty(e)||(n[e]=t[e])}(f)});t(h);var l=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(t,e){this.width=t,this.height=e};e.Size=n});t(l);l.Size;var p=e(function(t,e){var r,o=s&&s.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){this.x=0,this.y=0,this.width=t,this.height=e,this.type="Rect"}return t.prototype.setPosition=function(t,e){return"number"==typeof t?(this.x=t,this.y=e||t):(this.x=t.x,this.y=t.y),this},t.prototype.getPosition=function(){return h.v2(this.x,this.y)},t.prototype.setSize=function(t,e){return this.width=t,this.height=e,this},t.prototype.getContentSize=function(){return new l.Size(this.width,this.height)},t}(),i=function(r){function t(t,e){var n=r.call(this,t,e)||this;return n.color="#3a32af",n.type="Node",n}return o(t,r),t.prototype.setColor=function(t){return this.color=t,this},t}(e.Rect=n),u=function(r){function t(t,e){void 0===e&&(e=23);var n=r.call(this,t.length*e,e)||this;return n.fontStyle="serif",n.color="563a6d",n.text=t,n.fontSize=e,n.type="Label",n}return o(t,r),t.prototype.setFontSize=function(t){return this.fontSize=t,this.setSize(this.text.length*t,t),this},t.prototype.setFontStyle=function(t){return this.fontStyle=t,this},t.prototype.setText=function(t){return this.text=t,this},t}(e.Node=i);e.Label=u;var a=function(n){function t(t){var e=n.call(this,0,0)||this;return e.type="Sprite",e.img=new Image,e.img.src=t,e.setSize(e.img.width,e.img.height),e}return o(t,n),t.prototype.setSrc=function(t){return this.img.src=t,this},t}(n);e.Sprite=a});t(p);p.Rect,p.Node,p.Label,p.Sprite;var d=e(function(t,n){function e(t){for(var e in t)n.hasOwnProperty(e)||(n[e]=t[e])}Object.defineProperty(n,"__esModule",{value:!0}),e(c),e(p),e(l),e(h)});t(d);var y=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.createBlock=function(t,e){return void 0===e&&(e=t),new n(new d.Node(t,e))};var n=function(){function t(t){this.node=t,this.children=[]}return t.prototype.append=function(t){this.children.push(t)},t}();e.Block=n});t(y);y.createBlock,y.Block;var v=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.config={elementId:"root",MaxWidth:500,MaxHeight:500,bodySize:50,colors:{food:"yellow",body:"green",background:"blue",head:"red"},fps:500}});t(v);v.config;var g=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.Background=y.createBlock(v.config.MaxWidth,v.config.MaxHeight),e.Background.node.setColor(v.config.colors.background)});t(g);g.Background;var x=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){var n=this;this.instance=t,this.pre=null,this.set=function(e){return function(t){return n[e]=t,n}}};e.ListNode=n});t(x);x.ListNode;var b=e(function(t,e){var n=s&&s.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e};Object.defineProperty(e,"__esModule",{value:!0});var r=n(d),o=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.foot=t.reduce(function(t,e){return new x.ListNode(e).set("pre")(t)},null),this.step=this.foot.instance.getContentSize().width}return Object.defineProperty(t.prototype,"head",{get:function(){for(var t=this.foot;t.pre;)t=t.pre;return t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){for(var t=1,e=this.foot;e.pre;)e=e.pre,t++;return t},enumerable:!0,configurable:!0}),t.prototype.move=function(t){for(var e=this.foot;e.pre;){var n=e.pre.instance.getPosition();e.instance.setPosition(n),e=e.pre}return e.instance.setPosition(this.getNextPos(t)),this},t.prototype.eat=function(t){this.head.pre=new x.ListNode(t)},t.prototype.getNextPos=function(t){var e=this.head.instance.getPosition();switch(t){case"down":return r.v2(e.x,e.y-this.step);case"left":return r.v2(e.x-this.step,e.y);case"right":return r.v2(e.x+this.step,e.y);case"up":return r.v2(e.x,e.y+this.step)}},t.prototype.meet=function(t){return this.head.instance.getPosition().equals(t)},t}();e.Snake=o});t(b);b.Snake;var w=e(function(t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.random=function(t,e){return void 0===e&&(e=0),e+(t-e)*Math.random()},n.rand=function(t,e){return void 0===e&&(e=0),parseInt(String(n.random(t,e)))},n.randVec=function(t,e){return void 0===e&&(e=t),{x:n.rand(t),y:n.rand(e)}},n.uuid=function(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}});t(w);w.random,w.rand,w.randVec,w.uuid;var m=e(function(t,n){Object.defineProperty(n,"__esModule",{value:!0}),function(t){for(var e in t)n.hasOwnProperty(e)||(n[e]=t[e])}(w)});t(m);var k=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.getRandPos=function(t){var e=t.bodySize,n=t.MaxWidth,r=t.MaxHeight,o=m.rand(n/e),i=m.rand(r/e);return d.v2(e*o,e*i)},e.getRandColor=function(){var t=m.rand(0,10);return 8<t?"red":6<t?"green":4<t?"black":2<t?"":"yellow"}});t(k);k.getRandPos,k.getRandColor;var P=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.canvas=new d.Canvas(v.config),e.createFood=function(){var t=y.createBlock(v.config.bodySize);return t.node.setPosition(k.getRandPos(v.config)).setColor(k.getRandColor()),t};var n=y.createBlock(v.config.bodySize);n.node.setColor(v.config.colors.body).setPosition(150,50).setColor(v.config.colors.head),g.Background.append(n);var r=y.createBlock(v.config.bodySize);r.node.setColor(v.config.colors.body).setPosition(100,50),g.Background.append(r),e.snake=new b.Snake(n.node,r.node)});t(P);P.canvas,P.createFood,P.snake;var _=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e,n,r){this.callbackLeft=t,this.callbackRight=e,this.callbackUp=n,this.callbackDown=r,this.offset=100,this.delta=200}return t.prototype.onLeft=function(t){return this.callbackLeft=t,this},t.prototype.onRight=function(t){return this.callbackRight=t,this},t.prototype.onUp=function(t){return this.callbackUp=t,this},t.prototype.onDown=function(t){return this.callbackDown=t,this},t.prototype.setProps=function(t,e){return void 0===t&&(t=100),void 0===e&&(e=200),this.offset=t,this.delta=e,this},t.prototype.onStart=function(t){return this.callbackStart=t,this},t.prototype.onUpdate=function(t){return this.callbackUpdate=t,this},t.prototype.onStop=function(t){return this.callbackStop=t,this},t.prototype.listen=function(t){var e,n=this;void 0===t&&(t=document.body);var r,o=0;t.addEventListener("mouseenter",function(){r="enter"}),t.addEventListener("mousedown",function(t){e=t,(r="enter")===r&&n.callbackStart&&n.callbackStart(t)}),t.addEventListener("mousemove",function(t){o++,"enter"===r&&Boolean(e)&&n.callbackUpdate&&n.callbackUpdate(t)}),t.addEventListener("mouseup",function(t){o<n.delta&&n.testPos(e,t,t),o=0,"enter"===r&&n.callbackStop&&n.callbackStop(t),e=r=null}),t.addEventListener("mouseout",function(){r=null})},t.prototype.testPos=function(t,e,n){Math.abs(e.x-t.x)<this.offset&&Math.abs(e.y-t.y)<this.offset||(Math.abs(e.x-t.x)>Math.abs(e.y-t.y)?e.x-t.x>this.offset?this.callbackRight&&this.callbackRight(n):e.x-t.x<-this.offset&&this.callbackLeft&&this.callbackLeft(n):e.y-t.y>this.offset?this.callbackDown&&this.callbackDown(n):e.y-t.y<-this.offset&&this.callbackUp&&this.callbackUp(n))},t}();e.TouchFront=n});t(_);_.TouchFront;var M=e(function(t,n){Object.defineProperty(n,"__esModule",{value:!0}),function(t){for(var e in t)n.hasOwnProperty(e)||(n[e]=t[e])}(_)});return t(M),t(e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});function n(t){var e;P.canvas.clear(),e=t,a.walkAll(e,function(t){return P.canvas.draw(t.node)})}var r=P.createFood();g.Background.append(r);var o="right";i.schedule(function(){P.snake.move(o).meet(r.node.getPosition())&&(P.snake.eat(r.node),r=P.createFood(),g.Background.append(r)),n(g.Background)},{delta:v.config.fps}),(new M.TouchFront).onLeft(function(){return o="left"}).onRight(function(){return o="right"}).onUp(function(){return o="down"}).onDown(function(){return o="up"}).listen(),alert("鼠标滑动方向控制移动！准备好了么？")}))}();